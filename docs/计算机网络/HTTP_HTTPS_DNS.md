# 应用层 HTTP、HTTPS、DNS

## HTTP

**HTTP** **是一个在计算机世界里专门在「两点」之间「传输」文字、图片、音频、视频等「超文本」数据的「约定和规范」**





### 概述

**HTTP** 是一个在计算机中专门在**两点** 之间**传输**文字、图片、音频、视频等「**超文本**」数据的「**约定和规范**」。



可以说HTTP是用于从互联网服务器传输超文本到本地浏览器or两台服务器之间互相传输超文本的协议



### HTTP优缺点

**优点**

1. **简单**、

   报文格式：`header + body`，头部信息是`key-value`存储，易于理解

2. **灵活、易于扩展**

   请求方法、URL、状态码、头字段等不是固定的几个，允许开发者自定义和扩展

3. **应用广泛、跨平台**

**缺点**

1. **无状态**：

    - **好处**：不需要使用额外空间来记录状态信息，减轻了服务器负担

    - **坏处**：不记忆状态，服务器无法判断用户身份。

   ​				完成关联操作会很麻烦，不知道那些请求是相互关联的

   ​				如登录--加购--下单--支付这一系列步骤，是同一个用户来操作的，每次请求都需要获取一次身份信息

   ​				可以使用cookie来解决，cookie是包含用户信息的本地浏览器的文件，需要保存用户的省份信息的话，响应给浏览器一个cookie，后面再请求这个网站，将请求信息和cookie一起发送，服务器就能辨识用户的身份

2. **明文传输**：明文传输虽然方便阅读，但是将所有信息裸露在外，容易被窃取

3. **不安全**：

    - 通信使用明文，信息可能被窃取
    - 不验证对方身份，可能遇到假冒网站
    - 无法证明报文的完整性，可能报文被恶意修改，植入广告





### HTTP常见状态码

状态码类别

| 类别 |                         含义                         |
| :--: | :--------------------------------------------------: |
| 1XX  | **提示信息**，服务器收到了请求，需要用户继续执行操作 |
| 2XX  |            **成功**，请求被接收并处理完成            |
| 3XX  | **重定向**，资源位置发生变动，需要客户端重写发送请求 |
| 4XX  |        **客户端错误**，请求报文错误，无法处理        |
| 5XX  |      **服务器错误**，请求时，服务器内部发生错误      |

常见状态码

- **200：请求成功** ，非HEAD请求，服务器返回的响应头会有body数据
- 204：与200相同，但费HEAD请求，响应头没有body数据
- **301：永久重定向，请求的资源不存在，需要使用新的URL重新访问**
- 302：临时重定向，请求的资源在，暂时需要使用其他URL访问
- 304：缓存重定向，不跳转，重定向已存在的缓存文件
- 400：表示客户端请求的报文有错误，没有具体定位错误
- 403：服务器禁止访问资源，不是请求错误
- **404：请求的资源不存在 or 找不到**
- **500：服务器内部发生错误**，但没有具体定位
- 501：请求的功能不支持
- 502：服务器本身正常，访问后端服务器发生错误
- 503：服务器很忙，暂时无法响应



###  HTTP与HTTPS的区别

1. HTTP：超文本传输协议，明文传输，存在安全问题。HTTPS解决了HTTP的缺点，能够加密传输<-在TCP和HTTP之间加入了SSL/TLS协议
2. HTTP建立连接相对简单：TCP三次握手之后就可以进行报文传输。HTTPS在三次握手后，还需进行SSL/TLS的握手，才能进行报文传输
3. HTTP是80端口；HTTPS是443端口
4. HTTPS需要申请数字证书，来保证服务器的身份是可信的
5. HTTP协议的URL以`http://`开始，HTTPS的URL以`https://`开始


### HTTP存在的问题，以及HTTPS是如何解决的？

HTTP是明文传输，所以存在一些安全问题

- **窃听风险**：通信链路上可以获取通信内容
- **篡改风险**：强制植入广告、病毒
- **冒充风险**：假冒网购平台


HTTPS在TCP与HTTP之间加入了SSL/TLS协议，解决了这些问题

<img width='600px' src='https://s2.loli.net/2022/07/05/6QiS2A37IW4UPcz.png'/>

HTTPS 是如何解决上面的三个风险的?

- **混合加密**解决了**窃听风险**
- **摘要算法**解决了**篡改风险**
- **数字证书**，解决了**冒充风险**



### HTTP 1.0、HTTP 1.1及HTTP 2.0的主要区别
>短连接：每次请求都建立TCP连接，无法复用
>长连接：建立连接后保持连接，可以被多个请求复用

**http1.0**：每一次请求都会建立一个TCP连接，请求结束就释放连接，频繁的三次握手、四次挥手，性能开销大

**http1.1**：引入了长连接(keep-alive) ，在一个TCP连接上可以传送多个请求和响应，减少了建立和关闭连接带来的开销与延迟。服务端按请求的顺序，排队处理，队头请求超时，后续的请求就会阻塞(队头阻塞)；这样保证了客户端收到的数据与请求是对应的。响应头与请求头对应起来。

**http2.0**：
http2.0是基于HTTPS协议的
1. **二进制格式：** http1是纯文本的报文，http2是二进制的报文，不用像http1在接收后将超文本通过Base64转为字符串，到TCP层再转为二进制。
2. **多路复用**：可以在一个请求中并发多个请求和响应，不用像http1.1一样按请求的顺序来响应，没有 **[队头阻塞]** 的问题，降低了延迟，提高了连接的利用率
3. **压缩头部**：多个请求如果请求头一样，http2会自动去掉这些请求的重复部分，数据体积变小，传输速度变快，在客户端和服务端各维护一个header信息表，报文都会存入该表，生成一个索引，后续只发送索引就可以，提高了速度
4. **服务端推送**：服务端可以主动向客户端push消息(如加载网页的css、js等，提前发送给客户端，减少延迟)

### 描述一次完整的HTTP请求过程
客户端要访问www.baidu.com，浏览器发起一个DNS请求，如果本地缓存没有的话，就向根域名服务器查询，根服务器返回com服务器的信息，向com域名服务器查询，返回一个baidu.com服务器的信息，再向baidu.com域名服务器查询，最后返回地址:14.215.177.38,顺利进入百度首页



## HTTPS

### HTTPS加密过程
HTTPS使用混合加密的方式（加密对称与非加密对称混合使用）

### 对称加密与非对称加密
**对称加密**
对称的密钥
加密和解密使用同一个密钥，加密速度快，效率高 。但是不能安全的发送密钥。
![在这里插入图片描述](https://img-blog.csdnimg.cn/75cb5c569dde46b48bbfbf9e0535e768.png)


**非对称加密**
一对非对称的密钥
- **公钥**：自己的锁，可以随意让他人使用
- **私钥**：打开自己锁的钥匙，B使用A的公钥加密文件，发送给A，A使用私钥来打开这个文件
  ![在这里插入图片描述](https://img-blog.csdnimg.cn/c8bf1de00106442ea82e4f7895d04a52.png)

公钥和私钥都可以进行加密和解密

一般客户端使用公钥，服务端使用私钥

非对称加密的过程：
1. 客户端使用公钥将明文进行加密形成密文，发送给服务端
2. 服务端收到密文，使用私钥进行解密，得到明文
3. 将收到明文的确认信息发给客户端
4. 客户端可以使用对称加密来传递信息了

非对称加密不需要对方发送解密的密钥，非常安全，但是比对称加密就要慢很多
## DNS 域名解析过程
DNS( Domain Name System) 域名系统

访问网页，输入域名，通过DNS解析得到IP地址，从而访问

DNS通过UDP传输

### 域名的层级
- 根域名：`.root` 或 `.`  一般省略
- 顶级域名：`.com`、`.cn`、`.edu`、`.org`...
- 二级域名：`www.bilibili.com`中的`bilibili`
- 三级域名：`yahoo.co.uk`中的`yahoo`


### 解析过程
![在这里插入图片描述](https://img-blog.csdnimg.cn/efe5aa5bc70e471eb768a23a40281c38.png)
1. 客户端访问www.baidu.com，发起DNS解析请求。先查询浏览器中的DNS缓存，如果有且没有过期(缓存1分钟，容量1000条)，解析结束
2. 浏览器搜索操作系统中的DNS缓存
3. 发送到本地DNS服务器上，查询缓存记录，如果有记录直接返回
4. 本地DNS服务器向根服务器发送DNS请求，没查到就告诉本地DNS服务器该去哪个服务器查（`.com`域名服务器）
5. 本地DNS服务器向 .com服务器发送DNS请求，没查到就告诉本地DNS服务器去哪找
6. 本地DNS服务器向`baidu.com`域名服务器发送DNS请求，`baidu.com`域名服务器在缓存中发现映射关系，返回IP给本地DNS服务器
7. 本地DNS服务器将IP与域名的映射保存在缓存中，返回IP给客户端

### 查询方式
#### 递归查询
只发送一次请求，等待返回结果就可以
客户端->本地DNS服务器->根域名服务器->`.com`域名服务器->`baidu.com`域名服务器
客户端<-本地DNS服务器<-根域名服务器<-`.com`域名服务器<-`baidu.com`域名服务器
![在这里插入图片描述](https://img-blog.csdnimg.cn/164e3ef99b004a8491c3a478ea08409e.png)


#### 迭代查询
经过多次请求，得到结果

![在这里插入图片描述](https://img-blog.csdnimg.cn/e3b933b3d32a4d649f8dc082deae0de6.png)